import {notes, keybindings} from "./data.js";

const audioContext = new (window.AudioContext)();
const noteSounds = {};
notes.forEach(note => {
    const audio = new Audio(`sounds/${note}.wav`);
    audio.preload = 'auto';
    noteSounds[note] = audio;
});

function playNote(note) {
    // Basically resetting the audio back to zero incase it was played before
    if (noteSounds[note]) {
        const audio = new Audio(noteSounds[note].src);

        audio.currentTime = 0;
        audio.volume = 0.6;
        audio.play();

        document.querySelector(`.${note}`).classList.add("active");
        setTimeout(() => {
            document.querySelector(`.${note}`).classList.remove("active");
        }, 100);

    }
};


// Handle keyboard input 
document.addEventListener("keypress", (e) => {
    const note = keybindings[e.key.toLowerCase()];
    if (note) {
        playNote(note);
    }
})


// Handle mouse input
notes.forEach(note => {
    document.querySelector(`.${note}`).addEventListener("click", (e) => {
        e.stopPropagation();
        playNote(note);
    })
})

function debounce(func, wait) {
    let timeout;
    return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
    };
}

/*
Todo: 
- Add option to hide labels
- Add option to show notes
- Add option to change colors
- Good name title for the site and header
*/
